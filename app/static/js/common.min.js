// Common.js
// Generated by Fminmaker.py, version 1.01 beta © Rosan Finance
// Date: 2019-12-01 14:30
var keywords=new Object();var script_version=1;var default_timeout=100;var default_loader_timeout=300;var IsDebug=0;var IsDeepDebug=0;var IsTrace=0;var IsLog=0;var IsTraceCommit=0;var IsTraceRollback=0;var IsTraceErrorException=0;var IsForcedRefresh=0;var IsAdmin=0;var IsOperator=0;var IsAssumeExchangeError=0;var IsXMLDump=0;var IsCleanBefore=1;var IsCheckImageTimeout=0;var IsTriggeredSubmit=0;var IsShowLoader=0;var IsOptionRowspan=0;var IsOptionContainerChanged=0;var IsMSIE=0;var is_webkit=0;var default_submit_mode=0;var default_action=null;var default_log_action=null;var default_print_action=null;var default_handler=null;var default_params=null;var default_input_name='';var should_be_updated=false;var current_context='';var selected_menu_action=null;var selected_control=null;var semaphore_state=null;var treeview_state=null;var TID=new Array();var LINE='';var SUBLINE='';var TABLINE='tabline';var REFERENCE='reference';var isWebServiceExecute=false;var isSubmitted=false;var isKeyboardDisabled=false;var isConfirmation=false;var isDropdownActive=false;var isCallback=false;var confirm_action='';var confirm_response=null;var DEFAULT_HTML_SPLITTER=':';var CSS_INVISIBLE='invisible';var root='';var back='';var baseURI='';var loaderURI='';var page_state=-1;var page_scroll_top=0;var is_loaded_success=false;var is_show_error=false;var is_link=false;var is_scroll_top=false;var is_on_refresh=false;var no_window_scroll=false;function interrupt(start,mode,timeout,callback,index,type){if(start){var i=!is_null(index)?index:TID.length;var delay=timeout?timeout:default_timeout;var func=function(){interrupt(false,mode,0,callback,i,type);};if(i==TID.length)TID.push(null);if(type==1)TID[i]=window.setInterval(func,delay);else TID[i]=window.setTimeout(func,delay);if(IsLog)console.log('start:'+mode+',index:'+i+',len:'+TID.length);}else if(mode){if(IsLog)console.log('interrupt:'+mode+',TID:'+TID.join('-'));if(mode==-1){if(!callback)callback='';window.location.replace(callback);}else if(mode==1){interrupt(false,0,0,null,index);$ShowOnStartup();}else if(mode==2){interrupt(false,0,0,null,index);$ReferenceDialog.submit('refresh');}else if(mode==3){interrupt(false,0,0,null,index);$LineSelector.onReset();}else if(mode==4){interrupt(false,0,0,null,index);$onClickTreeView();}else if(mode==9) $Semaphore.run(index);}else if(TID.length>index&&TID[index]!=null){if(type==1)window.clearInterval(TID[index]);else window.clearTimeout(TID[index]);if(index==TID.length-1)TID.splice(index,1);else TID[index]=null;if(IsLog)console.log('stop index:'+index+',len:'+TID.length);}}function $_window_orientation(){return typeof(window.orientation) !== 'undefined'?(window.orientation==0||window.orientation==180?'portrait':'landscape'):(screen.msOrientation||screen.mozOrientation||(screen.orientation||{}).type);}function $_screen_with_scroll(mode){if(['height','H'].indexOf(mode)>-1)return $_height('max')>window.screen.height;return $_width('max')>window.screen.width;}function $_get_css_size(value){return value.toString()+"px";}function $_screen_center(mode){var f=$IS_FRAME?true:false;var m=mode||(!f?'screen-max':'screen-min');return{'W':$_width(m),'H':$_height(m) };}function $_height(m){var f=!$IS_FRAME?true:false;if(m=='screen-max')return Math.max(window.screen.availHeight,verge.viewportH());if(m=='screen-min')return Math.min(window.screen.availHeight,verge.viewportH());if(m=='max')return Math.max(window.screen.height,window.screen.availHeight,document.body.clientHeight,document.documentElement.clientHeight);if(m=='available'&&f){var mode=$_window_orientation().startswith('landscape')?'screen-min':'screen-max';return $_height(mode);}if(m=='client')return document.documentElement.clientHeight;else return Math.min(window.screen.height,window.screen.availHeight,document.body.clientHeight,document.documentElement.clientHeight);}function $_width(m){var f=!$IS_FRAME?true:false;if(m=='screen-max')return Math.max(window.screen.availWidth,verge.viewportW());if(m=='screen-min')return Math.min(window.screen.availWidth,verge.viewportW());if(m=='max')return Math.max(window.screen.width,window.screen.availWidth,document.body.clientWidth,document.documentElement.clientWidth);if(m=='available'&&f){var mode=$_window_orientation().startswith('landscape')?'screen-min':'screen-max';return $_width(mode);}if(m=='client')return document.documentElement.clientWidth;else return Math.min(window.screen.width,window.screen.availWidth,document.body.clientWidth,document.documentElement.clientWidth);}function $_get_item_id(ob,index){var x=ob.attr('id')||0;var id=(x&&x.indexOf(DEFAULT_HTML_SPLITTER)>-1&&x.startswith('row'))?x.split(DEFAULT_HTML_SPLITTER)[index||1]:x;return id;}function $_maximize(){window.moveTo(0,0);window.resizeTo($_width('max'), $_height('max'));}function $_set_body_value(id,value){$("#"+id).each(function(){$(this).val(value);});}function $_show_window_in_center(container,mode){var page=$("#html-container");var f=$IS_FRAME?true:false;var sh=f?40:20;var sw=0;var center=$_screen_center(mode);var top=int((center.H-container.height())/2)-sh;var left=int((center.W-container.width())/2)-sw;if($_screen_with_scroll('H'))top+=$(window).scrollTop();container .css('top', $_get_css_size(top)).css('left', $_get_css_size(left)) .show();}function $_init(){is_webkit=!(isIE||IsMSIE)?true:false;$Images.init();}function $onImagesPreload(){$ShowPageSubmitMessages();$Init();if(typeof($_show_page) === 'function')return;$ShowPage(0);}function $CurrentContext(){return current_context||'default';}function $ShowPage(disable){if(disable===null)return;var startup_page_container=$("#html-container");if(disable)startup_page_container.hide();else startup_page_container.removeClass("hidden").show();}function $ShowOnStartup(){selected_menu_action=default_log_action;$Handle(selected_menu_action,default_handler,default_params);}function $ShowSubline(){selected_menu_action=default_log_action;$Go(selected_menu_action);}function $ShowPageSubmitMessages(){function _get_object(id){var ob=$("#"+id);return !is_null(ob)?ob.val():null;}var errors=_get_object('errors');var OK=_get_object('OK');if(!is_empty(errors)) $ShowError(errors,true,true,false);else if(!is_empty(OK)) $NotificationDialog.open(OK);}function $ShowSystemMessages(reset,error){}function $TriggerActions(disable){if(IsTriggeredSubmit&&default_submit_mode==0) $ShowPage(disable);}function $ShowError(msg,is_ok,is_error,is_session_close){if(is_show_error||!msg)return;var container=$("#error-container");$("#error-text").html(msg);if(is_ok){$("#error-button").append( '<button id="error-button-ok" class="ui-button-text" onclick="javascript:$HideError();">'+keywords['OK']+'</button>' );}if(is_error)container.removeClass("warning").addClass("error");else container.removeClass("error").addClass("warning");$_show_window_in_center(container,null);is_show_error=true;$("#error-button-ok").focus();if(is_session_close&&!$IS_DEMO)interrupt(true, -1,5000,'',0);}function $HideError(){$("#error-container").hide();$("#error-button").html('');is_show_error=false;$SetFocus();}function $ShowLoader(start){if(is_show_error)return;if(start){var loader=$("#page-loader");var container=$("#html-container");if(start==-1){isWebServiceExecute=false;if(IsShowLoader)loader.hide();else container.removeClass("inprogress");$InProgress(null);}else{isWebServiceExecute=true;if(IsShowLoader) $_show_window_in_center(loader,null);else container.addClass("inprogress");}}}function $ActivateInfoData(show){var container=$("#info-data");if(is_null(container))return;if(show)container.show();else{container.hide();return;}$PageScroller.reset(true);}function $RemoveInfoData(){var container=$("#info-data");if(is_null(container))return;container.empty().hide();}function $InProgress(ob,mode){if(!is_null(ob)&&mode==1){ob.addClass("inprogress");selected_control=ob;}else if(!is_null(selected_control)){selected_control.removeClass("inprogress");selected_control=null;}}function $SetFocus(ob){}function $ResetSearch(deactivate){if(deactivate) $_deactivate_search();var search=$("#search-context");if(search.val()){var src=$SCRIPT_ROOT+'/static/img/';if(is_search_activated){$("#search-icon") .attr('title',keywords['Cancel search']) .attr('src',src+'db-close.png');}else{$("#search-icon") .attr('title',keywords['Search']) .attr('src',src+'db-search.png');search.val('');}}}function $HideLogPage(){var ob=SelectedGetItem(SUBLINE,'ob');if(IsLog)console.log('$HideLogPage:'+is_null(ob));if(!is_null(ob)) $onToggleSelectedClass(SUBLINE,ob,'remove',null);}function $ShowLogPage(){var ob=SelectedGetItem(SUBLINE,'ob');if(IsLog)console.log('$ShowLogPage:'+is_null(ob));if(!is_null(ob)) $onToggleSelectedClass(SUBLINE,ob,'add',null);if(is_scroll_top){$(window).scrollTop(0);is_scroll_top=false;}}function $ResetLogPage(){$("#command").val('');}function $Go(action){$web_logging(action);}function $Handle(action,handler,params){$web_logging(action,handler,params);}function $onParentFormSubmit(id){var frm=$("#"+(id||'filter-form'));var action=frm.attr('action');$SidebarControl.onBeforeSubmit();var is_run=1;try{is_run=performance.navigation.type==0?1:0;}catch(err) {}if(is_run) $("#OK",frm).val('run');var ob=$("#window_scroll",frm);var top=is_on_refresh?page_scroll_top:$(window).scrollTop();if(is_exist(ob))ob.val(!no_window_scroll?top:'');frm.submit();}function $onLineFormSubmit(){switch(default_submit_mode){case 0: $onParentFormSubmit();break;case 1:case 2: $Handle(default_action,default_handler,default_params);break;}}function $onPageLinkSubmit(link){var x=link.split('?');var url=x[0];var qs=x.length>1?strip(x[1]):'';url=url+'?'+(qs>''?qs+'&':'')+'sidebar='+$SidebarControl.state.toString();window.location.replace(url);}function $onToggleSelectedClass(key,ob,action,command,force){var id=!is_null(ob)?$_get_item_id(ob):SelectedGetItem(key,'id');var mask=[LINE,SUBLINE,TABLINE,REFERENCE].indexOf(key)>-1?'td':'dd';var input="input[name^='"+default_input_name+"']";if(IsLog)console.log('$onToggleSelectedClass:'+key+':'+id+':'+action+':'+mask+':'+input,ob);if(is_empty(id))return;if(is_null(ob))ob=SelectedGetItem(key,'ob');function make(ob,action,mode){if(is_null(ob))return;if(IsLog)console.log('$onToggleSelectedClass.make:'+action+':'+id);$(mask,ob).each(function(){if(IsOptionRowspan&&($(this).hasClass("noselected")||$(this).prop('rowspan')>1)) $.noop();else if(action=='add'){$(this).addClass("selected");if(key==LINE&&mode==1) $(input).each(function(){$(this).val(id);});}else $(this).removeClass("selected");});if(action=='add'){ob.addClass("selected");SelectedSetItem(key,'ob',ob);}else{ob.removeClass("selected");SelectedSetItem(key,'ob',null);}} $("#command").val(!is_null(command)?command:'');switch(action){case 'submit':if(isWebServiceExecute||key!=LINE)return;$(input).each(function(){$(this).val(id);});if(force){$onParentFormSubmit();return;}if(default_submit_mode>0){make(SelectedGetItem(key,'ob'),'remove',0);SelectedReset();make(ob,'add',0);}$onLineFormSubmit();break;case 'clean': $(input).each(function(){$(this).val('');});SelectedSetItem(key,'ob',null);break;default:make(ob,action,1);}}function $setPaginationFormSubmit(page){$("input[name='page']").each(function(){$(this).val(is_null(page)?'1':page.toString());});}function $onOpenHelp(){$HelpDialog.open();return true;}function $onRefreshClick(){$("#command").val('refresh');$onParentFormSubmit();}function $onResetClick(){$("#command").val('init-filter');$onParentFormSubmit('init-form');}function $onExportClick(){$("#command").val('export');$onParentFormSubmit();}function $onControlPanelClick(ob){if(isDropdownActive)return;var id=ob.attr('id');var dropdown=(id=="admin-panel-dropdown"?$("#admin-panel"):(id=="services-dropdown"?$("#services"):(id=="actions-dropdown"?$("#actions"):null)));if(is_null(dropdown))return;var dropdown_id=dropdown.attr('id');var is_selected=!(is_null(selected_dropdown)||selected_dropdown[0].attr('id')==dropdown_id);isDropdownActive=true;if(is_selected)selected_dropdown[0].slideToggle('slow');dropdown.slideToggle('slow',function(){isDropdownActive=false;});var is_closed=!is_null(selected_dropdown)&&selected_dropdown[1]==dropdown_id;selected_dropdown=is_closed?null:new Array(dropdown,dropdown_id);}jQuery(function($){$("#sidebar-navigator").click(function(e){$SidebarControl.onNavigatorClick(false);});$("#sidebarFrame").on("mouseleave",function(e){if(!(isIE||IsMSIE||isFirefox)||$(this).has(e.target).length==0) $SidebarControl.onFrameMouseOut();e.stopPropagation();}).on("mouseenter",function(e){$SidebarControl.onFrameMouseOver();e.stopPropagation();});$("a.mainmenu").click(function(e){var link=$(this).prop('href');$onPageLinkSubmit(link);e.preventDefault();return false;});$("#refresh").click(function(e){$onRefreshClick();e.preventDefault();});$("#init-filter").click(function(e){$onResetClick();e.preventDefault();});$("#export").click(function(e){$onExportClick();e.preventDefault();});$("#back").click(function(e){window.location.replace(back||root);e.preventDefault();});$("#reload").click(function(e){window.location.reload();e.preventDefault();});function $onSearchSubmit(e){var s=strip($("#search-context").val());if(is_search_focused||is_null(e)){search_context=s;$("#search-context").val(s);if(is_empty(s)) $("input[id='reset_search']").each(function(){$(this).val('1');});else $("input[id='searched']").each(function(){$(this).val(s);});$LineSelector.onFormSubmit();$setPaginationFormSubmit(1);$onParentFormSubmit('filter-form');}} $("#search-context").focusin(function(e){is_search_focused=true;}).focusout(function(e){is_search_focused=false;});$("#search-icon").click(function(e){$onSearchSubmit(null);$onParentFormSubmit('filter-form');});$("#search-form").submit(function(e){$onSearchSubmit(e);});$(".dropdown-link").click(function(e){$onControlPanelClick($(this));e.preventDefault();});$(window).focus(function(){if(is_on_refresh)return;page_scroll_top=$(window).scrollTop();if(typeof($_activate) === 'function'&&$_activate(1)){is_on_refresh=true;$HideError();$ShowPage(1);$onRefreshClick();}else $Semaphore.start(true);}).blur(function(){$Semaphore.stop(false);});$(window).on("resize",function(){$SidebarControl.initState();});$("a.page").click(function(e){var link=$(this).prop('href');$onPageLinkSubmit(link);e.preventDefault();return false;});$(window).keydown(function(e){var exit=false;if(e.keyCode==116){$onRefreshClick();exit=true;}if(e.shiftKey&&e.keyCode==112)exit=$onOpenHelp();if($ConfirmDialog.is_focused()||$NotificationDialog.is_focused()||page_is_focused(e)||isKeyboardDisabled)return;try{if($BaseDialog.is_focused()||is_search_focused)return;}catch(err) {}if(e.shiftKey&&[67,79].indexOf(e.keyCode)>-1){$SidebarControl.onNavigatorClick(false);exit=true;}else if(e.shiftKey&&e.keyCode==82){$onResetClick();exit=true;}else if(e.shiftKey&&e.keyCode==83){var focused=$("#search-context");$SidebarControl.onFrameMouseOver(focused);focused.focus();exit=true;}else if(e.ctrlKey||e.shiftKey){if(isWebServiceExecute)return;if(e.keyCode==38)exit=$LineSelector.up();else if(e.keyCode==40)exit=$LineSelector.down();else if(e.ctrlKey&&e.keyCode==36)exit=$LineSelector.home();else if(e.shiftKey&&e.keyCode==33)exit=$LineSelector.pgup();else if(e.shiftKey&&e.keyCode==34)exit=$LineSelector.pgdown();else if(e.ctrlKey&&e.keyCode==35)exit=$LineSelector.end();else if(e.shiftKey&&e.keyCode==9)exit=$TabSelector.tab();else if(e.ctrlKey&&e.keyCode==37)exit=$TabSelector.left();else if(e.ctrlKey&&e.keyCode==39)exit=$TabSelector.right();}else if(e.altKey){if(isWebServiceExecute)return;var before=true;if(typeof keyboard_alt_before=== 'function')before=keyboard_alt_before(e.keyCode);if(before){if(e.keyCode==38)exit=$ActiveSelector.up();else if(e.keyCode==40)exit=$ActiveSelector.down();else if([33,36].indexOf(e.keyCode)>-1)exit=$ActiveSelector.home();else if([34,35].indexOf(e.keyCode)>-1)exit=$ActiveSelector.end();}else exit=true;if(typeof keyboard_alt_after=== 'function'&&before)keyboard_alt_after(e.keyCode);}if(exit){e.preventDefault();return false;}});});function $web_semaphore(action){if(isWebServiceExecute||!$Semaphore.isEnabled())return;if(IsLog)console.log('web_semaphore:',action);$Semaphore.running();var args={'action':action,'template':$Semaphore.template,'lid':$Semaphore.lid, };$.post($SCRIPT_ROOT+'/semaphore/loader',args,function(x){var state=x['state'];$Semaphore.refresh(state);},'json') .fail(function(){$Semaphore.error();}) .always(function(){});}
